"use strict";var app=angular.module("flipbookApp",["ngAnimate","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main",resolve:{auth:["$q","authenticationSvc",function(a,b){var c=b.getUserInfo();return c?a.when(c):(console.log("fuck off"),a.reject({authenticated:!1}))}]}}).when("/contact",{templateUrl:"views/contact.html",controller:"ContactCtrl",controllerAs:"contact",resolve:{auth:["$q","authenticationSvc",function(a,b){var c=b.getUserInfo();return c?a.when(c):(console.log("fuck off"),a.reject({authenticated:!1}))}]}}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl",controllerAs:"login"}).when("/registration",{templateUrl:"views/registration.html",controller:"RegistrationCtrl",controllerAs:"registration",resolve:{auth:["$q","authenticationSvc",function(a,b){var c=b.getUserInfo();return c?a.when(c):(console.log("fuck off"),a.reject({authenticated:!1}))}]}}).when("/createImage",{templateUrl:"views/createimage.html",controller:"CreateimageCtrl",controllerAs:"createImage",resolve:{auth:["$q","authenticationSvc",function(a,b){var c=b.getUserInfo();return c?a.when(c):(console.log("fuck off"),a.reject({authenticated:!1}))}]}}).when("/gifs",{templateUrl:"views/gallery.html",controller:"GalleryCtrl",controllerAs:"galleryCtrl",resolve:{auth:["$q","authenticationSvc",function(a,b){var c=b.getUserInfo();return c?a.when(c):a.reject({authenticated:!1})}]}}).when("/gifs/:id",{templateUrl:"views/viewgif.html",controller:"ViewgifCtrl",controllerAs:"viewGif",resolve:{auth:["$q","authenticationSvc",function(a,b){var c=b.getUserInfo();return c?a.when(c):a.reject({authenticated:!1})}]}})}]).run(["$rootScope","$location",function(a,b){a.$on("$routeChangeSuccess",function(a){}),a.$on("$routeChangeError",function(a,c,d,e){e.authenticated===!1&&b.path("/login")})}]);angular.module("flipbookApp").controller("MainCtrl",["authenticationSvc",function(a){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],this.logout=function(){a.logout()}}]),angular.module("flipbookApp").controller("LoginCtrl",["$http","globalVariables","User","authenticationSvc",function(a,b,c,d){console.log("login controller"),this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"];var e=this;e.user={},this.logUserIn=function(){var a=e.user;d.login(a)}}]),angular.module("flipbookApp").controller("RegistrationCtrl",["authenticationSvc",function(a){console.log("hey from signup"),this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"];var b=this;b.user={},this.signup=function(){var c=b.user;a.signUp(c)}}]),angular.module("flipbookApp").directive("sidebar",function(){return console.log("sidebar.js"),{templateUrl:"../views/sidebar.html"}}),angular.module("flipbookApp").value("globalVariables",{baseUrl:"localhost"===document.location.hostname?"http://localhost:3000":"http://flipbook-api.herokuapp.com"}),angular.module("flipbookApp").factory("User",function(){var a={isLoggedIn:!1,token:""};return{someMethod:function(){return a}}}),angular.module("flipbookApp").controller("CreateimageCtrl",["$http","globalVariables","authenticationSvc","savedImages",function(a,b,c,d){function e(a){var b;b=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):decodeURI(a.split(",")[1]);for(var c=a.split(",")[0].split(":")[1].split(";")[0],d=new Uint8Array(b.length),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([d],{type:c})}console.log("create image");var f=c.getUserInfo(),g=document.getElementById("canvasEl"),h=g.getContext("2d");this.saveFrame=function(c){var i=g.toDataURL(),j=e(i),k=new FormData(c.target);k.append("image[file]",j);var l=b.baseUrl+"/images";console.log(f),console.log(d.images),a.post(l,k,{transformRequest:angular.identity,headers:{"Content-Type":void 0,Authorization:"Token token="+f.token}}).success(function(a){d.images.push(a.file),console.log(a.file.location),console.log(d.images),h.clearRect(0,0,h.canvas.width,h.canvas.height),h.fillStyle="#FFFFFF",h.fillRect(0,0,300,300)})},this.componentImages=d.images,this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("flipbookApp").controller("GalleryCtrl",["$scope","$http","globalVariables","gif","$location","authenticationSvc",function(a,b,c,d,e,f){console.log("gallery controller loaded");var g=f.getUserInfo(),h=this;this.getGifs=function(){console.log("getting gifs"),b({method:"get",url:c.baseUrl+"/gifs",headers:{Authorization:"Token token="+g.token}}).success(function(a){console.log("gif index successful"),console.log(a),d.gallery=[];for(var b=0;b<a.gifs.length;b++)d.gallery.push(a.gifs[b])})},this.getGifs(),this.gifGallery=function(){return d.gallery},this.viewGif=function(a){e.path("/gifs/"+a.id)},this.deleteGif=function(a){console.log("delete gif");var d=h.gifGallery().indexOf(a);b({method:"delete",url:c.baseUrl+"/gifs/"+a._id,headers:{Authorization:"Token token="+g.token}}).success(function(){console.log("delete gif successful"),h.gifGallery().splice(d,1)})},this.editGif=function(a,d){console.log("edit gif"),console.log(d.target);var e=new FormData(d.target);b({method:"patch",url:c.baseUrl+"/gifs/"+a._id,transformRequest:angular.identity,headers:{"Content-Type":void 0,Authorization:"Token token="+g.token},data:e}).success(function(a){console.log("edit gif successful"),console.log(a)})},this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("flipbookApp").directive("sketch",function(){return{restrict:"A",link:function(a,b){function c(){b[0].width=b[0].width}function d(a,b,c,d){g.moveTo(a,b),g.lineTo(c,d),g.strokeStyle="#000",g.stroke()}function e(a,b,c){a.href=f.toDataURL(),a.download=c}var f=document.getElementById("canvasEl"),g=f.getContext("2d");g.canvas.width=300,g.canvas.height=300,g.fillStyle="#FFFFFF",g.fillRect(0,0,300,300),$("#file_input").change(function(a){g.clearRect(0,0,g.canvas.width,g.canvas.height);var b=window.URL||window.URL,c=b.createObjectURL(a.target.files[0]),d=new Image;d.crossOrigin="Anonymous",d.src=c,d.onload=function(){g.fillStyle="#FFFFFF",g.fillRect(0,0,300,300);var a=d.width,b=d.height,c=0,e=0,f=300;a>b?(c=f,e=f*b/a):b>a?(c=f*a/b,e=f):(c=f,e=f),g.drawImage(d,0,0,c,e),console.log("should be loaded now...")},$("#file_input").val("")});var h,i,j,k,l=!1;b.bind("mousedown",function(a){h=a.offsetX,i=a.offsetY,g.beginPath(),l=!0}),b.bind("mousemove",function(a){l&&(j=a.offsetX,k=a.offsetY,d(h,i,j,k),h=j,i=k)}),b.bind("mouseup",function(){l=!1}),document.getElementById("clear-image").addEventListener("click",function(){c()},!1),document.getElementById("download").addEventListener("click",function(){e(this,"canvas","image.png")},!1)}}}),angular.module("flipbookApp").factory("savedImages",function(){var a={images:[]};return a}),angular.module("flipbookApp").directive("frame",function(){return{templateUrl:"../views/frame.html",restrict:"A",link:function(a,b){var c=b[0].firstChild,d=c.getContext("2d");d.canvas.width=100,d.canvas.height=100;var e=new Image;e.crossOrigin="Anonymous",e.onload=function(){d.drawImage(e,0,0,100,100)},e.src=a.image.location,b.on("click",function(){b.toggleClass("clicked")})}}}),angular.module("flipbookApp").controller("FrameCtrl",["gif",function(a){this.viewImage=function(b){var c=a.frames.indexOf(b.location);c>-1?a.frames.splice(c):a.frames.push(b.location),console.log(a.frames)},this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("flipbookApp").factory("authenticationSvc",["$q","$http","globalVariables","$window","$location",function(a,b,c,d,e){function f(){return k}function g(f){console.log("authenticationSvc - login");var g=a.defer();return b({method:"post",url:c.baseUrl+"/sign-in",contentType:!1,processData:!1,data:f}).then(function(a){console.log("logged in"),console.log(a.data.user),k={id:a.data.user._id,token:a.data.user.token,email:a.data.user.email},d.sessionStorage.userInfo=JSON.stringify(k),g.resolve(k),console.log(k),e.path("/")},function(a){g.reject(a)}),g.promise}function h(){d.sessionStorage.userInfo&&(k=JSON.parse(d.sessionStorage.userInfo))}function i(a){console.log("signup"),console.log(a),b({method:"post",url:c.baseUrl+"/sign-up",contentType:!1,processData:!1,data:a}).success(function(b){console.log("holy shit...."),console.log(b),g(a)})}function j(){var f=a.defer();return b({method:"DELETE",url:c.baseUrl+"/sign-out/"+k.id,headers:{Authorization:"Token token="+k.token}}).then(function(a){console.log("signed out booyah"),d.sessionStorage.userInfo=null,k=null,f.resolve(a),e.path("/login")},function(a){f.reject(a)}),f.promise}console.log("authentication factory");var k;return h(),{getUserInfo:f,signUp:i,login:g,logout:j}}]),angular.module("flipbookApp").controller("GifCtrl",["authenticationSvc","gif","globalVariables","$http",function(a,b,c,d){function e(a){var b;b=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):decodeURI(a.split(",")[1]);for(var c=a.split(",")[0].split(":")[1].split(";")[0],d=new Uint8Array(b.length),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([d],{type:c})}console.log("gif controller loaded");var f=a.getUserInfo(),g=this,h={show:!1};this.product=h;var i;this.gifText="",this.gifTextLocation="",this.gifFontWeight="",this.gifFontColor="",this.makeGif=function(){console.log("make gif function"),h.show=!0,$("#gif-goes-here").children().length>0&&$("#gif-goes-here").empty(),gifshot.createGIF({gifWidth:300,gifHeight:300,images:b.frames,interval:.3,text:g.gifText,fontWeight:g.gifFontWeight,fontFamily:"Arial",fontColor:g.gifFontColor,textBaseline:g.gifTextLocation},function(a){if(!a.error){var c=a.image,d=document.createElement("img");d.src=c,i=d,document.getElementById("gif-goes-here").appendChild(d),b.frames=[]}})},this.killGif=function(){$("#gif-goes-here").empty(),h.show=!1},this.saveGif=function(a){console.log("save gif function");var b=e(i.src),j=new FormData(a.target);j.append("gif[src]",i.src),j.append("gif[file]",b);var k=c.baseUrl+"/gifs";d.post(k,j,{transformRequest:angular.identity,headers:{"Content-Type":void 0,Authorization:"Token token="+f.token}}).success(function(a){console.log("success"),h.show=!1,g.killGif(),console.log(a)})},this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("flipbookApp").factory("gif",function(){console.log("gif factory");var a={frames:[],gallery:[]};return a}),angular.module("flipbookApp").directive("gif",function(){return{templateUrl:"../views/gif.html",restrict:"A",link:function(a,b){var c=b[0].firstElementChild,d=c.getContext("2d");d.canvas.width=150,d.canvas.height=150;var e=new Image;e.crossOrigin="Anonymous",e.onload=function(){d.drawImage(e,0,0,150,150)},e.src=a.gif.location}}}),angular.module("flipbookApp").controller("ViewgifCtrl",["$http","globalVariables","authenticationSvc","$routeParams","$location",function(a,b,c,d,e){console.log("view gif controller");var f=c.getUserInfo(),g=this;a({method:"get",url:b.baseUrl+"/gifs/"+d.id,headers:{Authorization:"Token token="+f.token}}).success(function(a){console.log("get gif successful"),console.log(a),g.gif=a;var b=document.createElement("img");b.src=a.gif.src,document.getElementById("show-single-gif-here").appendChild(b)}),this.goBack=function(){e.path("/gifs")},this.viewAtUrl=function(a){console.log("view"),console.log(a),window.open(a.location,"_blank")},this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("flipbookApp").run(["$templateCache",function(a){a.put("views/contact.html","<p>This is the contact view.</p>"),a.put("views/createimage.html",'<div class="create-image" ng-controller="CreateimageCtrl as createImage"> <h3>Canvas</h3> <div class="well well-sm"> <div class="row"> <div class="col-md-6"> <div class="image-canvas"> <input type="file" id="file_input"> <canvas id="canvasEl" sketch></canvas> <a id="download">Download as image</a> <a id="clear-image">clear image</a> <form ng-submit="createImage.saveFrame($event)"> <input type="hidden" ng-model="createImage.image.name" name="image[name]" value="imageName"> <input type="submit" class="btn rounded-btn" value="save frame"> </form> </div> </div> <div class="col-md-6" ng-controller="GifCtrl as gifCtrl"> <div id="gif-goes-here"> </div> <form class="form-horizontal" ng-hide="gifCtrl.product.show" ng-submit="gifCtrl.makeGif()"> <div class="row"> <div class="col-md-6"> <div class="form-group"> <label for="gifCaption"> Caption </label> <input id="gifCaption" type="text" ng-model="gifCtrl.gifText" placeholder="write on your gif"> </div> <div class="form-group"> <label> Caption Placement </label> <div class="radio"> <label> <input type="radio" ng-model="gifCtrl.gifTextLocation" value="top">Top </label> </div> <div class="radio"> <label> <input type="radio" ng-model="gifCtrl.gifTextLocation" value="center">Center </label> </div> <div class="radio"> <label> <input type="radio" ng-model="gifCtrl.gifTextLocation" value="bottom">Bottom </label> </div> </div> <div class="form-group"> <label> Font Weight </label> <div class="radio"> <label> <input type="radio" ng-model="gifCtrl.gifFontWeight" value="normal">Normal </label> </div> <div class="radio"> <label> <input type="radio" ng-model="gifCtrl.gifFontWeight" value="bold">Bold </label> </div> </div> </div> <div class="col-md-6"> <div class="form-group"> <label> Font Color </label> <div class="radio"> <label> <input type="radio" ng-model="gifCtrl.gifFontColor" value="#FF0000">Red </label> </div> <div class="radio"> <label> <input type="radio" ng-model="gifCtrl.gifFontColor" value="#FF00FF">Pink </label> </div> <div class="radio"> <label> <input type="radio" ng-model="gifCtrl.gifFontColor" value="#FF4500">Orange </label> </div> <div class="radio"> <label> <input type="radio" ng-model="gifCtrl.gifFontColor" value="#FFFF00">Yellow </label> </div> <div class="radio"> <label> <input type="radio" ng-model="gifCtrl.gifFontColor" value="#00FF00">Green </label> </div> <div class="radio"> <label> <input type="radio" ng-model="gifCtrl.gifFontColor" value="#0000FF">Blue </label> </div> <div class="radio"> <label> <input type="radio" ng-model="gifCtrl.gifFontColor" value="#6600cc">Purple </label> </div> <div class="radio"> <label> <input type="radio" ng-model="gifCtrl.gifFontColor" value="#000000">Black </label> </div> <div class="radio"> <label> <input type="radio" ng-model="gifCtrl.gifFontColor" value="#FFFFFF">White </label> </div> </div> </div> </div> <input type="submit" class="btn rounded-btn" value="Make gif"> </form> <!--<button ng-click="gifCtrl.makeGif()">Make gif</button>--> <button ng-show="gifCtrl.product.show" ng-click="gifCtrl.killGif()">Kill gif</button> <form name="save-gif-form" ng-show="gifCtrl.product.show" ng-submit="gifCtrl.saveGif($event)" novalidate> <div class="form-group"> <label for="gifName">Gif Name</label> <input id="gifName" type="text" ng-model="gifCtrl.gif.name" name="gif[name]" value="" placeholder="name your gif" required> </div> <div class="form-group"> <label for="gifComment">Gif Comment</label> <input id="gifComment" type="text" ng-model="gifCtrl.gif.comment" name="gif[comment]" value="" placeholder="make a comment" required> </div> <input type="submit" class="btn rounded-btn" value="save gif"> </form> </div> </div> </div> <h5>Filmstrip</h5> <div ng-controller="FrameCtrl as frameCtrl" ng-repeat="image in createImage.componentImages"> <div class="component-images" frame></div> </div> </div>'),a.put("views/frame.html",'<canvas ng-click="frameCtrl.viewImage(image)"></canvas>'),a.put("views/gallery.html",'<!-- Page Heading --> <div class="row"> <div class="col-lg-12"> <h1 class="page-header">Gallery <small>Your dope-ass GIFs</small> </h1> </div> </div> <!-- /.row --> <div> <!-- Projects Row --> <div class="row"> <div class="col-md-3 portfolio-item" ng-repeat="gif in galleryCtrl.gifGallery()"> <div class="gif-thumbnail" gif></div> </div> </div> <!-- /.row --> </div>'),a.put("views/gif.html",'<canvas></canvas> <div class="gif-details"> <div class="gif-name">{{gif.name}}</div> <div class="gif-comment">{{gif.comment}}</div> </div> <div class="gif-options-button"> <button class="btn btn-success" ng-click="galleryCtrl.viewGif(gif)">view</button> <button class="btn btn-danger" ng-click="galleryCtrl.deleteGif(gif)">delete</button> </div> <div class="gif-edit-button" ng-init="editMode = false"> <button class="btn btn-primary btn-sm" ng-click="editMode = true">edit</button> </div> <div class="gif-edit-panel" ng-show="editMode"> <div class="form-group"> <form ng-submit="galleryCtrl.editGif(gif, $event)"> <div> <label for="gifName">Gif Name</label> <input id="gifName" type="text" ng-model="gif.name" name="name" value="{{gif.name}}" placeholder="name your gif"> </div> <div> <label for="gifComment">Gif Comment</label> <input id="gifComment" type="text" ng-model="gif.comment" name="comment" value="{{gif.comment}}" placeholder="make a comment"> </div> <input type="submit" class="btn btn-sm rounded-btn" value="edit"> <button type="button" class="btn btn-primary btn-sm" ng-click="editMode = false">cancel</button> </form> </div> </div>'),a.put("views/login.html",'<div class="login-page"> <div class="row"> <div class="col-lg-12"> <img src="images/logo.b3869143.png" class="site-avatar"> <h1>flipbook <br><small>bring your images to life.</small></h1> <div ng-init="tab = 0" ng-show="tab === 0"> <button ng-click="tab = 1" class="btn rounded-btn">sign up</button> <button ng-click="tab = 2" class="btn rounded-btn">log in</button> </div> <div ng-show="tab === 1"> <form role="form" ng-controller="RegistrationCtrl as registrationCtrl" ng-submit="registrationCtrl.signup()"> <div class="form-content"> <div class="form-group"> <input type="text" class="form-control input-underline input-lg" id="" placeholder="Email" ng-model="registrationCtrl.user.credentials.email"> </div> <div class="form-group"> <input type="password" class="form-control input-underline input-lg" id="" placeholder="Password" ng-model="registrationCtrl.user.credentials.password"> </div> </div> <input type="submit" class="btn rounded-btn" value="sign up"> </form> <button type="button" ng-click="tab = 0" class="btn rounded-btn">cancel</button> </div> <div ng-show="tab === 2"> <form role="form" ng-controller="LoginCtrl as loginCtrl" ng-submit="loginCtrl.logUserIn()"> <div class="form-content"> <div class="form-group"> <input type="text" class="form-control input-underline input-lg" id="" placeholder="Email" ng-model="loginCtrl.user.credentials.email"> </div> <div class="form-group"> <input type="password" class="form-control input-underline input-lg" id="" placeholder="Password" ng-model="loginCtrl.user.credentials.password"> </div> </div> <input type="submit" class="btn rounded-btn" value="log in"> </form> <button type="button" ng-click="tab = 0" class="btn rounded-btn">cancel</button> </div> </div> </div> </div>'),a.put("views/main.html","<div class=\"well well-sm title-content\"> <h1>Welcome to Flipbook</h1> <h5>bring your images to life</h5> </div> <div class=\"row marketing\"> <h4>GIF Animator</h4> <p> Draw a scribble, save it as a 'frame' of a gif, and then put a bunch of them together to create a gif... like an online flipbook. </p> <h4>GifShot</h4> <p> This gif-ification used in this app was imported from the tool 'Gifshot', which has some really cool features like using your webcam to create GIFs. Say cheese! </p> <h4>Angular</h4> <p>This app is written with Angular, connecting to a backend written in Express and Node, with a Mongo database. If only there were some accronym for that stack... something like... ENAM. Nah that's weird. Oh well.</p> </div>"),a.put("views/registration.html","<p>This is the registration view.</p>"),a.put("views/sidebar.html",'<aside class="sidebar"> <div class="sidenav-outer"> <div class="menu-body"> <ul class="nav nav-pills nav-stacked sidenav"> <li> <a href="#/" class="website-name"> flipbook </a> </li> <li> <a href="#/" class="logo"> <img src="images/logo.b3869143.png" class="site-avatar"> <p class="text-xs-center"></p> </a> </li> <li> <a href="#/"> <i class="fa fa-home"></i> <span>&nbsp; Home</span> </a> </li> <li> <a href="#/gifs"> <i class="fa fa-folder-open-o"></i> <span>&nbsp; Gallery</span> </a> </li> <li> <a href="#/createImage"> <i class="fa fa-plus"></i> <span>&nbsp; Create</span> </a> </li> <li></li> <li ng-controller="MainCtrl as mainCtrl"> <a ng-click="mainCtrl.logout()"> <i class="fa fa-sign-out"></i> <span>&nbsp;&nbsp; Logout</span> </a> </li> </ul> </div> </div> </aside>'),a.put("views/viewgif.html",'<!-- Page Heading --> <div class="row"> <div class="col-lg-12"> <h1 class="page-header">{{viewGif.gif.gif.name}} <small>{{viewGif.gif.gif.comment}}</small> </h1> </div> </div> <!-- /.row --> <div class="single-gif" id="show-single-gif-here"></div> <button class="btn btn-primary" ng-click="viewGif.goBack()">back</button> <p>Not working? Try this:</p> <button class="btn btn-primary" ng-click="viewGif.viewAtUrl(viewGif.gif.gif)">view at url</button>')}]);